
// Total Controlled Folder Access events
DeviceEvents
 | where ActionType  startswith "ControlledFolderAccess" 
 | summarize NumberOfEvents=count() by ActionType
 | sort by NumberOfEvents desc

 // Controlled Folder Access events across devices
DeviceEvents
 | where ActionType startswith "ControlledFolderAccess" 
 | summarize AsrDetections=count() by DeviceName
 | order by AsrDetections desc

// Exploit Guard Controlled Folder Access details
DeviceEvents 
| where ActionType contains "ControlledFolderAccess"
| extend JsonOut = parse_json(AdditionalFields)
| sort by Timestamp desc 
| project Timestamp, DeviceName, InitiatingProcessAccountName, ActionType,  
         FileName, FolderPath, RemoteUrl, ProcessCommandLine, InitiatingProcessCommandLine,
         JsonOut.IsAudit,JsonOut.Uri,JsonOut.RuleId,JsonOut.ActivityId

